<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dream's Academy - অ্যাডমিন প্যানেল (Updated)</title>
    <link rel="icon" type="image/png" href="https://i.ibb.co/JqgWkCg/placeholder.png">
    <!-- Google Fonts: Hind Siluri for Bengali -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Google Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

    <style>
        /* --- General Styles & Variables --- */
        :root {
            --primary-blue: #0a4d68;
            --secondary-blue: #088395;
            --light-blue: #05bfdb;
            --accent-green: #28a745;
            --accent-red: #dc3545;
            --accent-yellow: #ffc107;
            --background-light: #f8f9fa;
            --text-dark: #212529;
            --text-light: #ffffff;
            --border-color: #dee2e6;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            --card-radius: 12px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; }
        body {
            font-family: 'Hind Siliguri', sans-serif;
            background-color: var(--background-light);
            color: var(--text-dark);
            line-height: 1.6;
        }
        .hidden { display: none !important; }

        /* --- START: GORGEOUS LOGIN PAGE STYLES (MODIFIED) --- */
        #login-page {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: linear-gradient(135deg, #0a4d68 0%, #05bfdb 100%);
            animation: gradient-animation 15s ease infinite;
            background-size: 400% 400%;
            overflow: hidden; /* Prevents scrollbars during animation */
        }

        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .login-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            width: 90%;
            max-width: 400px;
            text-align: center;
            animation: fadeInFromBottom 0.8s ease-out forwards;
        }
        
        @keyframes fadeInFromBottom {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .login-box h2 {
            margin-bottom: 35px;
            color: var(--text-light);
            font-weight: 700;
            font-size: 2em;
        }
        
        /* Floating Label Styling */
        .login-box .input-group {
            position: relative;
            margin-bottom: 30px;
        }

        .login-box .input-group input {
            width: 100%;
            padding: 14px 10px;
            border: none;
            border-bottom: 2px solid rgba(255, 255, 255, 0.5);
            background: transparent;
            color: var(--text-light);
            font-size: 1em;
            font-family: 'Hind Siliguri', sans-serif;
        }

        .login-box .input-group label {
            position: absolute;
            top: 14px;
            left: 10px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .login-box .input-group input:focus {
            outline: none;
            border-bottom-color: var(--light-blue);
        }

        /* The magic for floating label */
        .login-box .input-group input:focus + label,
        .login-box .input-group input:valid + label {
            top: -12px;
            left: 5px;
            font-size: 0.85em;
            color: var(--light-blue);
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        .btn-primary {
            background: linear-gradient(90deg, var(--secondary-blue), var(--light-blue));
            color: var(--text-light);
            width: 100%;
            justify-content: center;
            padding: 14px;
            font-size: 1.1em;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        /* --- END: GORGEOUS LOGIN PAGE STYLES (MODIFIED) --- */


        /* --- Admin Panel Layout --- */
        #admin-panel {
            display: flex;
        }
        .sidebar {
            width: 260px;
            background: var(--text-light);
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            display: flex;
            flex-direction: column;
        }
        .sidebar-header {
            padding: 20px;
            font-size: 1.5em;
            font-weight: 700;
            color: var(--primary-blue);
            border-bottom: 1px solid var(--border-color);
        }
        .sidebar-nav {
            list-style: none;
            flex-grow: 1;
            overflow-y: auto;
        }
        .sidebar-nav a {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            text-decoration: none;
            color: var(--text-dark);
            font-weight: 600;
            border-left: 4px solid transparent;
        }
        .sidebar-nav li.active a, .sidebar-nav a:hover {
            background: #eaf6f6;
            color: var(--secondary-blue);
            border-left-color: var(--secondary-blue);
        }
        .logout-btn {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: none;
            border: none;
            width: 100%;
            text-align: left;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            border-top: 1px solid var(--border-color);
        }
        .logout-btn:hover { background-color: #fcebeb; color: var(--accent-red); }

        .main-content {
            margin-left: 260px;
            width: calc(100% - 260px);
            padding: 30px;
        }
        .page { display: none; }
        .page.active { display: block; }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        .page-header h1 { color: var(--primary-blue); }

        .btn-add {
            background-color: var(--accent-green);
            color: var(--text-light);
        }
        .btn-add .material-symbols-outlined { font-size: 20px; }


        /* --- Content Cards & Tables --- */
        .content-box {
            background: var(--text-light);
            padding: 30px;
            border-radius: var(--card-radius);
            box-shadow: var(--shadow);
            overflow-x: auto;
        }
        /* START: NEW SEARCH BAR STYLE */
        .search-bar-container {
            margin-bottom: 20px;
        }
        #user-search-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1em;
            font-family: 'Hind Siliguri', sans-serif;
        }
        #user-search-input:focus {
            outline: none;
            border-color: var(--secondary-blue);
            box-shadow: 0 0 0 2px rgba(8, 131, 149, 0.2);
        }
        /* END: NEW SEARCH BAR STYLE */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95em;
        }
        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
        }
        .data-table th { background-color: var(--background-light); }
        .actions-cell { white-space: nowrap; width: 1%;}
        .actions-cell button {
            background: none;
            border: none;
            cursor: pointer;
            margin-right: 10px;
            padding: 5px;
        }
        .actions-cell .material-symbols-outlined {
            transition: color 0.3s ease;
        }
        .btn-edit .material-symbols-outlined { color: var(--secondary-blue); }
        .btn-edit:hover .material-symbols-outlined { color: var(--primary-blue); }
        .btn-delete .material-symbols-outlined { color: var(--accent-red); }
        .btn-delete:hover .material-symbols-outlined { color: #b02a37; }

        /* START: WHATSAPP BUTTON STYLE */
        .btn-whatsapp {
            color: var(--accent-green);
        }
        .btn-whatsapp:hover {
            color: #1e7e34;
        }
        /* END: WHATSAPP BUTTON STYLE */

        .status-select {
            padding: 6px 10px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            font-family: 'Hind Siliguri', sans-serif;
            font-size: 0.9em;
        }
        /* NEW: Styles for referrer input */
        .referrer-input {
            padding: 6px 10px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            font-family: 'Hind Siliguri', sans-serif;
            font-size: 0.9em;
            margin-right: 5px;
            width: 120px;
        }
        .status-badge {
            padding: 5px 12px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.85em;
            color: var(--text-light);
        }
        .status-badge.pending { background-color: var(--accent-yellow); color: var(--text-dark); }
        .status-badge.approved { background-color: var(--accent-green); }
        .status-badge.rejected { background-color: var(--accent-red); }
        .status-badge.paid { background-color: var(--accent-green); } /* For Withdrawals */
        .btn-save-status {
            background-color: var(--secondary-blue);
            color: var(--text-light);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.9em;
            margin-left: 5px;
        }

        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .stat-card {
            background: var(--text-light);
            padding: 25px;
            border-radius: var(--card-radius);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 20px;
            border-left: 5px solid var(--primary-blue);
        }
        .stat-card .icon {
            font-size: 3em;
            color: var(--primary-blue);
        }
        .stat-card h3 { font-size: 2.5em; }
        .stat-card p { color: #6c757d; }
        .stat-card.pending-card { border-left-color: var(--accent-yellow); }
        .stat-card.pending-card .icon { color: var(--accent-yellow); }
        /* START: NEW STYLES FOR SALES CARDS */
        .stat-card.sales-card { border-left-color: var(--accent-green); }
        .stat-card.sales-card .icon { color: var(--accent-green); }
        /* END: NEW STYLES FOR SALES CARDS */


        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: var(--card-radius);
            width: 90%;
            max-width: 800px; /* Increased width for curriculum */
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .modal-header h2 { color: var(--primary-blue); }
        #close-modal {
            background: none; border: none; font-size: 28px; cursor: pointer;
        }
        .form-group { margin-bottom: 15px; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }
        .modal-footer {
            margin-top: 25px;
            text-align: right;
        }
        .btn-cancel { background: #6c757d; color: white; margin-right: 10px; }

        /* --- START: UPDATED Curriculum Modal Specific Styles --- */
        #curriculum-modules-container {
            margin-top: 20px;
        }
        .module-container {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #fdfdff;
        }
        .module-header-flex {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .module-header-flex h4 {
            font-size: 1.1em;
            color: var(--primary-blue);
        }
        .btn-remove {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            padding: 5px 10px;
            font-size: 0.9em;
        }
        .btn-add-small {
            background: #eaf6f6;
            color: var(--secondary-blue);
            padding: 8px 15px;
            font-size: 0.9em;
            margin-top: 10px;
        }
        .video-entry {
            display: flex;
            flex-direction: column;
            gap: 10px;
            border-top: 1px solid var(--border-color);
            padding-top: 15px;
            margin-top: 15px;
        }
        .video-entry:first-child {
            border-top: none;
            padding-top: 0;
            margin-top: 0;
        }
        .video-entry-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr 100px auto;
            gap: 10px;
            align-items: center;
        }
        .video-entry input, .video-entry textarea {
            padding: 8px;
            width: 100%;
            border: 1px solid var(--border-color);
            border-radius: 6px;
        }
        .video-entry textarea {
            resize: vertical;
            min-height: 60px;
        }
        .video-entry .btn-remove { align-self: center; height: 42px; }
        /* --- END: UPDATED Curriculum Modal Specific Styles --- */

        /* --- START: Mobile Responsive Styles --- */
        .mobile-header {
            display: none; /* Hidden on desktop */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: var(--text-light);
            z-index: 990;
            padding: 10px 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            align-items: center;
            gap: 15px;
        }
        #mobile-menu-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--primary-blue);
        }
        #mobile-page-title {
            font-size: 1.2em;
            font-weight: 600;
            color: var(--primary-blue);
        }
        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 998; /* Below sidebar, above content */
        }

        @media (max-width: 768px) {
            .mobile-header {
                display: flex;
            }
            .main-content {
                margin-left: 0;
                width: 100%;
                padding-top: 80px; /* Avoid content hiding behind fixed mobile header */
            }
            .sidebar {
                /* Instead of display:none, make it slide out */
                left: -270px; /* Start off-screen */
                z-index: 999;
                transition: left 0.3s ease-in-out;
            }
            .sidebar.open {
                left: 0; /* Slide into view */
            }
            /* Adjust video entry grid for smaller screens */
            .video-entry-inputs {
                grid-template-columns: 1fr; /* Stack inputs vertically */
            }
            .video-entry .btn-remove {
                justify-self: start; /* Align button to the left */
            }
            
            /* START: New Responsive Table Styles for Mobile */
            #payments-page .data-table thead,
            #users-page .data-table thead {
                display: none; /* Hide table headers on mobile */
            }

            #payments-page .data-table tr,
            #users-page .data-table tr {
                display: block;
                margin-bottom: 15px;
                border: 1px solid var(--border-color);
                border-radius: var(--card-radius);
                box-shadow: 0 2px 5px rgba(0,0,0,0.05);
                padding: 15px;
                background-color: var(--text-light);
            }

            #payments-page .data-table td,
            #users-page .data-table td {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 10px 5px;
                text-align: right;
                border-bottom: 1px dotted #e9ecef;
            }

            #payments-page .data-table tr td:last-child,
            #users-page .data-table tr td:last-child {
                border-bottom: none;
            }

            #payments-page .data-table td::before,
            #users-page .data-table td::before {
                content: attr(data-label);
                font-weight: 600;
                text-align: left;
                margin-right: 15px;
                color: var(--primary-blue);
            }

            /* Center align action cells */
            .data-table .actions-cell {
                justify-content: center;
                padding-top: 15px;
            }
            
            /* --- START: MODIFIED CODE --- */
            /* Handle complex cells like status updates - IMPROVED FOR MOBILE */
            #payments-page .data-table .actions-cell {
                display: flex;
                flex-direction: column;
                align-items: center; /* Center all controls horizontally */
                gap: 8px; /* Add space between each control */
                padding-top: 15px;
            }

            #payments-page .data-table .actions-cell .referrer-input,
            #payments-page .data-table .actions-cell .status-select,
            #payments-page .data-table .actions-cell .btn-save-status {
                width: 90%; /* Make them wide, but with some breathing room */
                max-width: 300px; /* Set a generous max width */
                margin: 0; /* Reset any default margins */
                display: block; /* Ensure block-level behavior */
                box-sizing: border-box; /* Include padding in width calculation */
                padding: 12px; /* Add generous padding to make them easy to tap */
                font-size: 1em; /* Ensure font size is readable */
            }

            /* Center the text within the select dropdown */
            #payments-page .data-table .actions-cell .status-select {
                text-align: center;
                text-align-last: center;
            }
            
            /* Ensure secondary buttons are nicely spaced */
            #payments-page .data-table .actions-cell .btn-whatsapp,
            #payments-page .data-table .actions-cell .btn-delete {
                margin-top: 5px; /* Add a little extra space above them */
            }
            /* --- END: MODIFIED CODE --- */

            /* Style for copyable mobile number */
            .copyable-mobile {
                cursor: pointer;
                padding: 5px;
                border-radius: 4px;
                transition: background-color 0.2s;
                -webkit-tap-highlight-color: rgba(0,0,0,0.1); /* Remove tap highlight on mobile */
            }
            /* END: New Responsive Table Styles for Mobile */
        }
        /* --- END: Mobile Responsive Styles --- */

    </style>
</head>
<body>

    <!-- ======================= Login Page ======================= -->
    <div id="login-page">
        <div class="login-box">
            <h2>অ্যাডমিন লগইন</h2>
            <form id="login-form">
                <div class="input-group">
                    <input type="email" id="email" required>
                    <label for="email">ইমেল</label>
                </div>
                <div class="input-group">
                    <input type="password" id="password" required>
                    <label for="password">পাসওয়ার্ড</label>
                </div>
                <button type="submit" class="btn btn-primary">লগইন করুন</button>
            </form>
        </div>
    </div>

    <!-- ======================= Admin Panel ======================= -->
    <div id="admin-panel" class="hidden">
        <!-- Mobile Header -->
        <header class="mobile-header">
            <button id="mobile-menu-btn" class="material-symbols-outlined">menu</button>
            <span id="mobile-page-title">ড্যাশবোর্ড</span>
        </header>

        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">Dream's Academy</div>
            <ul class="sidebar-nav">
                <li class="active" data-page="dashboard-page"><a href="#"><span class="material-symbols-outlined">dashboard</span> ড্যাশবোর্ড</a></li>
                <li data-page="payments-page"><a href="#"><span class="material-symbols-outlined">receipt_long</span> পেমেন্ট ম্যানেজমেন্ট</a></li>
                <li data-page="users-page"><a href="#"><span class="material-symbols-outlined">group</span> শিক্ষার্থী ম্যানেজমেন্ট</a></li>
                <li data-page="services-page"><a href="#"><span class="material-symbols-outlined">construction</span> সার্ভিস ম্যানেজ</a></li>
                <li data-page="send-service-page"><a href="#"><span class="material-symbols-outlined">send</span> সার্ভিস পাঠান</a></li>
                <li data-page="courses-page"><a href="#"><span class="material-symbols-outlined">school</span> কোর্স ম্যানেজ</a></li>
                <li data-page="enrollments-page"><a href="#"><span class="material-symbols-outlined">assignment_ind</span> কোর্স এনরোলমেন্ট</a></li>
                <li data-page="curriculum-page"><a href="#"><span class="material-symbols-outlined">list_alt</span> কারিকুলাম ম্যানেজ</a></li>
                <li data-page="notices-page"><a href="#"><span class="material-symbols-outlined">campaign</span> নোটিশবোর্ড ম্যানেজ</a></li>
                <li data-page="join-class-page"><a href="#"><span class="material-symbols-outlined">video_call</span> ক্লাস জয়েনিং</a></li>
                <li data-page="withdrawals-page"><a href="#"><span class="material-symbols-outlined">paid</span> উত্তোলন</a></li>
                <li data-page="settings-page"><a href="#"><span class="material-symbols-outlined">settings</span> ওয়েবসাইট সেটিংস</a></li>
            </ul>
            <button class="logout-btn" id="logout-btn"><span class="material-symbols-outlined">logout</span> লগ আউট</button>
        </aside>

        <!-- Overlay for mobile menu -->
        <div id="overlay" class="hidden"></div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Page -->
            <div id="dashboard-page" class="page active">
                <div class="page-header">
                    <h1>ড্যাশবোর্ড</h1>
                </div>
                <!-- START: MODIFIED DASHBOARD GRID -->
                <div class="stats-grid">
                    <div class="stat-card sales-card">
                        <span class="material-symbols-outlined icon">payments</span>
                        <div>
                            <h3 id="total-sales">৳0</h3>
                            <p>মোট টাকার সেলস</p>
                        </div>
                    </div>
                    <div class="stat-card sales-card">
                        <span class="material-symbols-outlined icon">today</span>
                        <div>
                            <h3 id="current-month-sales">৳0</h3>
                            <p>বর্তমান মাসের সেলস</p>
                        </div>
                    </div>
                    <!-- NEW PROFIT CARDS START -->
                    <div class="stat-card sales-card">
                        <span class="material-symbols-outlined icon">trending_up</span>
                        <div>
                            <h3 id="total-profit">৳0</h3>
                            <p>মোট লাভ</p>
                        </div>
                    </div>
                    <div class="stat-card sales-card">
                        <span class="material-symbols-outlined icon">show_chart</span>
                        <div>
                            <h3 id="current-month-profit">৳0</h3>
                            <p>বর্তমান মাসের লাভ</p>
                        </div>
                    </div>
                    <!-- NEW PROFIT CARDS END -->
                    <div class="stat-card pending-card">
                        <span class="material-symbols-outlined icon">pending_actions</span>
                        <div>
                            <h3 id="pending-payments">0</h3>
                            <p>পেন্ডিং পেমেন্ট</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <span class="material-symbols-outlined icon">group</span>
                        <div>
                            <h3 id="total-students">0</h3>
                            <p>মোট শিক্ষার্থী</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <span class="material-symbols-outlined icon">construction</span>
                        <div>
                            <h3 id="total-services">0</h3>
                            <p>মোট সার্ভিস</p>
                        </div>
                    </div>
                     <div class="stat-card">
                        <span class="material-symbols-outlined icon">school</span>
                        <div>
                            <h3 id="total-courses">0</h3>
                            <p>মোট কোর্স</p>
                        </div>
                    </div>
                     <div class="stat-card">
                        <span class="material-symbols-outlined icon">campaign</span>
                        <div>
                            <h3 id="total-notices">0</h3>
                            <p>মোট নোটিশ</p>
                        </div>
                    </div>
                </div>
                <!-- END: MODIFIED DASHBOARD GRID -->
            </div>

            <!-- Payments Page -->
            <div id="payments-page" class="page">
                <div class="page-header">
                    <h1>পেমেন্ট ম্যানেজমেন্ট</h1>
                </div>
                <div class="content-box">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ইমেইল</th>
                                <th>কোর্স/সার্ভিস</th>
                                <th>পরিমাণ</th>
                                <th>লাভ</th>
                                <th>TrxID</th>
                                <th>সময়</th>
                                <th>স্ট্যাটাস</th>
                                <th>অ্যাকশন</th>
                            </tr>
                        </thead>
                        <tbody id="payments-table-body">
                            <!-- Data will be populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- START: MODIFIED USER MANAGEMENT PAGE -->
            <div id="users-page" class="page">
                <div class="page-header">
                    <h1>শিক্ষার্থী ম্যানেজমেন্ট</h1>
                </div>
                <!-- START: ADDED SEARCH BAR -->
                <div class="search-bar-container">
                    <input type="text" id="user-search-input" placeholder="আপনার কাঙ্ক্ষিত স্টূডেন্টকে খুজুন">
                </div>
                <!-- END: ADDED SEARCH BAR -->
                <div class="content-box">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>নাম</th>
                                <th>ইমেইল</th>
                                <th>মোবাইল</th>
                                <th>রেফারেল কোড</th>
                                <th>ব্যালেন্স</th>
                                <th>অ্যাকশন</th>
                            </tr>
                        </thead>
                        <tbody id="users-table-body">
                            <!-- Data will be populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- END: MODIFIED USER MANAGEMENT PAGE -->

            <!-- Services Page -->
            <div id="services-page" class="page">
                <div class="page-header">
                    <h1>সার্ভিস ম্যানেজমেন্ট</h1>
                    <button class="btn btn-add" onclick="openModalForAdd('services')"><span class="material-symbols-outlined">add</span> নতুন সার্ভিস</button>
                </div>
                <div class="content-box">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>সার্ভিসের নাম</th>
                                <th>ক্রয়মূল্য</th>
                                <th>বর্তমান মূল্য</th>
                                <th>কমিশন</th>
                                <th>অ্যাকশন</th>
                            </tr>
                        </thead>
                        <tbody id="services-table-body">
                            <!-- Data will be populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Send Service Page -->
            <div id="send-service-page" class="page">
                <div class="page-header">
                    <h1>হোয়াটসঅ্যাপে সার্ভিস পাঠান</h1>
                </div>
                <div class="content-box">
                    <form id="send-service-form">
                        <div class="form-group">
                            <label for="whatsapp-number">শিক্ষার্থীর হোয়াটসঅ্যাপ নম্বর</label>
                            <input type="text" id="whatsapp-number" placeholder="যেমন: 017XXXXXXXX" required>
                        </div>
                        <div class="form-group">
                            <label for="service-selection">সার্ভিস বা কোর্স নির্বাচন করুন</label>
                            <select id="service-selection" required>
                                <option value="">লোড হচ্ছে...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="service-info">সার্ভিসের তথ্য (যা পাঠাতে চান)</label>
                            <textarea id="service-info" rows="8" placeholder="এখানে সার্ভিসের বিস্তারিত তথ্য, যেমন - লগইন আইডি, পাসওয়ার্ড বা অন্য কোনো জরুরি বার্তা লিখুন।" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: auto;">
                            <span class="material-symbols-outlined">send</span> পাঠিয়ে দিন
                        </button>
                    </form>
                    <!-- START: Updated Instructional Text -->
                    <p style="margin-top: 20px; font-size: 0.9em; color: #6c757d;">
                        <strong>লক্ষ্য করুন:</strong> "পাঠিয়ে দিন" বাটনে ক্লিক করলে আপনার মোবাইলে সরাসরি হোয়াটসঅ্যাপ অ্যাপ খুলবে অথবা কম্পিউটারে হোয়াটসঅ্যাপ ওয়েব খুলবে। মেসেজটি সেখানে স্বয়ংক্রিয়ভাবে লেখা থাকবে, আপনাকে শুধু পাঠাতে হবে। নিশ্চিত করুন যে আপনার অ্যাডমিন নম্বর (01701126965) দিয়ে হোয়াটসঅ্যাপ-এ লগইন করা আছে।
                    </p>
                    <!-- END: Updated Instructional Text -->
                </div>
            </div>

            <!-- Courses Page -->
            <div id="courses-page" class="page">
                <div class="page-header">
                    <h1>কোর্স ম্যানেজমেন্ট</h1>
                    <button class="btn btn-add" onclick="openModalForAdd('courses')"><span class="material-symbols-outlined">add</span> নতুন কোর্স</button>
                </div>
                 <div class="content-box">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>কোর্সের নাম</th>
                                <th>প্রশিক্ষক</th>
                                <th>মূল্য</th>
                                <th>কমিশন</th>
                                <th>অ্যাকশন</th>
                            </tr>
                        </thead>
                        <tbody id="courses-table-body">
                            <!-- Data will be populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="enrollments-page" class="page">
                <div class="page-header">
                    <h1>কোর্স এনরোলমেন্ট</h1>
                    <button class="btn btn-add" onclick="openModalForAdd('enrollments')"><span class="material-symbols-outlined">add</span> নতুন এনরোলমেন্ট</button>
                </div>
                <div class="content-box">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>শিক্ষার্থীর ইমেইল</th>
                                <th>কোর্সের নাম</th>
                                <th>ব্যাচ নং</th>
                                <th>অ্যাকশন</th>
                            </tr>
                        </thead>
                        <tbody id="enrollments-table-body">
                            <!-- Data will be populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Curriculum Page -->
            <div id="curriculum-page" class="page">
                <div class="page-header">
                    <h1>কারিকুলাম ম্যানেজমেন্ট</h1>
                    <button class="btn btn-add" onclick="openModalForAdd('curriculum')"><span class="material-symbols-outlined">add</span> নতুন কারিকুলাম</button>
                </div>
                <div class="content-box">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>কোর্সের নাম</th>
                                <th>ব্যাচ নং</th>
                                <th>মডিউল সংখ্যা</th>
                                <th>অ্যাকশন</th>
                            </tr>
                        </thead>
                        <tbody id="curriculum-table-body">
                            <!-- Data will be populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Notices Page -->
            <div id="notices-page" class="page">
                <div class="page-header">
                    <h1>নোটিশবোর্ড ম্যানেজমেন্ট</h1>
                    <button class="btn btn-add" onclick="openModalForAdd('notices')"><span class="material-symbols-outlined">add</span> নতুন নোটিশ</button>
                </div>
                 <div class="content-box">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>শিরোনাম</th>
                                <th>বর্ণনা</th>
                                <th>অ্যাকশন</th>
                            </tr>
                        </thead>
                        <tbody id="notices-table-body">
                            <!-- Data will be populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Join Class Page -->
            <div id="join-class-page" class="page">
                <div class="page-header">
                    <h1>ক্লাস জয়েনিং ম্যানেজমেন্ট</h1>
                    <button class="btn btn-add" onclick="openModalForAdd('joinClass')"><span class="material-symbols-outlined">add</span> নতুন ক্লাস লিঙ্ক</button>
                </div>
                <div class="content-box">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>কোর্সের নাম</th>
                                <th>ব্যাচ নং</th>
                                <th>টপিক</th>
                                <th>ক্লাসের লিঙ্ক</th>
                                <th>সময়</th>
                                <th>অ্যাকশন</th>
                            </tr>
                        </thead>
                        <tbody id="join-class-table-body">
                            <!-- Data will be populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- NEW WITHDRAWAL REQUESTS PAGE -->
            <div id="withdrawals-page" class="page">
                <div class="page-header">
                    <h1>উত্তোলনের অনুরোধ সমূহ</h1>
                </div>
                <div class="content-box">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ইমেইল</th>
                                <th>পরিমাণ</th>
                                <th>মাধ্যম</th>
                                <th>অ্যাকাউন্ট নম্বর</th>
                                <th>অনুরোধের তারিখ</th>
                                <th>স্ট্যাটাস</th>
                                <th>অ্যাকশন</th>
                            </tr>
                        </thead>
                        <tbody id="withdrawals-table-body">
                            <!-- Data will be populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>


            <div id="settings-page" class="page">
                <div class="page-header">
                    <h1>ওয়েবসাইট সেটিংস</h1>
                </div>
                <div class="content-box">
                    <h3 style="margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px;">হিরো সেকশন</h3>
                    <form id="hero-settings-form">
                        <div class="form-group">
                            <label for="hero-image-url">হিরো ইমেজ URL</label>
                            <input type="text" id="hero-image-url" placeholder="আপনার ছবির লিংক এখানে দিন">
                        </div>
                        <div class="form-group">
                            <label>বর্তমান ছবি প্রিভিউ</label>
                            <img id="hero-image-preview" src="https://i.ibb.co/JqgWkCg/placeholder.png" alt="Hero Image Preview" style="max-width: 100%; max-height: 250px; border: 1px solid var(--border-color); border-radius: 8px; object-fit: cover;">
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: auto; justify-content: flex-start;">সেটিংস সেভ করুন</button>
                    </form>
                    
                    <hr style="margin: 30px 0;">
                    <h3 style="margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px;">লোগো ইমেজ</h3>
                    <form id="logo-settings-form">
                        <div class="form-group">
                            <label for="logo-image-url">হেডার লোগো ইমেজ URL</label>
                            <input type="text" id="logo-image-url" placeholder="আপনার লোগো ছবির লিংক এখানে দিন">
                        </div>
                        <div class="form-group">
                            <label>বর্তমান লোগো প্রিভিউ</label>
                            <img id="logo-image-preview" src="https://i.ibb.co/JqgWkCg/placeholder.png" alt="Logo Preview" style="max-height: 50px; border: 1px solid var(--border-color); border-radius: 8px; background: #f0f0f0; padding: 5px;">
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: auto; justify-content: flex-start;">লোগো ইমেজ সেভ করুন</button>
                    </form>
                    
                    <hr style="margin: 30px 0;">

                    <h3 style="margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px;">আমাদের সম্পর্কে সেকশন</h3>
                    <form id="about-us-settings-form">
                        <div class="form-group">
                            <label for="about-us-image-url">'আমাদের সম্পর্কে' পাতার ইমেজ URL</label>
                            <input type="text" id="about-us-image-url" placeholder="আপনার ছবির লিংক এখানে দিন">
                        </div>
                        <div class="form-group">
                            <label>বর্তমান ছবি প্রিভিউ</label>
                            <img id="about-us-image-preview" src="https://i.ibb.co/JqgWkCg/placeholder.png" alt="About Us Image Preview" style="max-width: 100%; max-height: 250px; border: 1px solid var(--border-color); border-radius: 8px; object-fit: cover;">
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: auto; justify-content: flex-start;">সেটিংস সেভ করুন</button>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <!-- ======================= Modal for Add/Edit ======================= -->
    <div id="admin-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title"></h2>
                <button id="close-modal" class="material-symbols-outlined">close</button>
            </div>
            <form id="modal-form">
                <!-- Form fields will be dynamically inserted here -->
            </form>
        </div>
    </div>

    <!-- Firebase SDKs (Compatibility Version) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyAu6Lo33AH6GWFDHusaP14fmAHb0LEzWOQ",
          authDomain: "go-pixel-f1c13.firebaseapp.com",
          projectId: "go-pixel-f1c13",
          storageBucket: "go-pixel-f1c13.appspot.com",
          messagingSenderId: "390711689002",
          appId: "1:390711689002:web:0ce672f38aeca40d2f6853"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        document.addEventListener('DOMContentLoaded', function() {
            // --- DOM Elements ---
            const loginPage = document.getElementById('login-page');
            const adminPanel = document.getElementById('admin-panel');
            const loginForm = document.getElementById('login-form');
            const logoutBtn = document.getElementById('logout-btn');
            const sidebar = document.querySelector('.sidebar');
            const sidebarLinks = document.querySelectorAll('.sidebar-nav li');
            const pages = document.querySelectorAll('.page');

            const adminModal = document.getElementById('admin-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalForm = document.getElementById('modal-form');
            const closeModalBtn = document.getElementById('close-modal');
            const heroSettingsForm = document.getElementById('hero-settings-form');
            const logoSettingsForm = document.getElementById('logo-settings-form');
            const aboutUsSettingsForm = document.getElementById('about-us-settings-form');
            
            const sendServiceForm = document.getElementById('send-service-form');
            const serviceSelection = document.getElementById('service-selection');
            const serviceInfoTextarea = document.getElementById('service-info');

            // --- Mobile Navigation Elements ---
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const mobilePageTitle = document.getElementById('mobile-page-title');
            const overlay = document.getElementById('overlay');

            // --- START: USER SEARCH FUNCTIONALITY ---
            const userSearchInput = document.getElementById('user-search-input');
            if(userSearchInput) {
                userSearchInput.addEventListener('keyup', () => {
                    const searchTerm = userSearchInput.value.toLowerCase().trim();
                    const tableBody = document.getElementById('users-table-body');
                    const rows = tableBody.getElementsByTagName('tr');

                    Array.from(rows).forEach(row => {
                        // Check if the row is a data row by looking for 'td' elements
                        if (row.getElementsByTagName('td').length > 0) {
                            const rowText = row.textContent || row.innerText;
                            if (rowText.toLowerCase().includes(searchTerm)) {
                                row.style.display = ""; // Reverts to CSS defined display (block on mobile, table-row on desktop)
                            } else {
                                row.style.display = 'none';
                            }
                        }
                    });
                });
            }
            // --- END: USER SEARCH FUNCTIONALITY ---

            // --- Authentication ---
            auth.onAuthStateChanged(user => {
                if (user) {
                    loginPage.classList.add('hidden');
                    adminPanel.classList.remove('hidden');
                    navigateTo('dashboard-page');
                } else {
                    loginPage.classList.remove('hidden');
                    adminPanel.classList.add('hidden');
                }
            });

            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                auth.signInWithEmailAndPassword(email, password)
                    .catch(error => {
                        console.error("Login Error:", error);
                        alert('ভুল ইমেল অথবা পাসওয়ার্ড!');
                    });
            });

            logoutBtn.addEventListener('click', () => {
                auth.signOut();
            });
            
            // --- Mobile Navigation Logic ---
            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', () => {
                    sidebar.classList.add('open');
                    overlay.classList.remove('hidden');
                });
            }
            if (overlay) {
                overlay.addEventListener('click', () => {
                    sidebar.classList.remove('open');
                    overlay.classList.add('hidden');
                });
            }

            // --- START: Helper for Click-to-Copy ---
            window.copyToClipboard = function(text) {
                if (!text || text.trim() === 'N/A' || text.trim() === '') {
                    alert("কোনো মোবাইল নম্বর পাওয়া যায়নি।");
                    return;
                }
                navigator.clipboard.writeText(text).then(function() {
                    alert(`নম্বরটি "${text}" ক্লিপবোর্ডে কপি করা হয়েছে।`);
                }, function(err) {
                    console.error('Async: Could not copy text: ', err);
                    alert('দুঃখিত, নম্বরটি কপি করা যায়নি।');
                });
            }
            // --- END: Helper for Click-to-Copy ---

            // --- Navigation ---
            function navigateTo(pageId) {
                pages.forEach(p => p.classList.remove('active'));
                document.getElementById(pageId).classList.add('active');

                sidebarLinks.forEach(l => l.classList.remove('active'));
                const activeLink = document.querySelector(`.sidebar-nav li[data-page="${pageId}"]`);
                activeLink.classList.add('active');
                
                if (mobilePageTitle && activeLink) {
                    const linkAnchor = activeLink.querySelector('a');
                    mobilePageTitle.textContent = linkAnchor.childNodes[linkAnchor.childNodes.length - 1].textContent.trim();
                }
                
                if (window.innerWidth <= 768) {
                    sidebar.classList.remove('open');
                    overlay.classList.add('hidden');
                }

                // Refresh data on page navigation
                switch(pageId) {
                    case 'dashboard-page': renderDashboard(); break;
                    case 'payments-page': renderPayments(); break;
                    case 'users-page': renderUsers(); break;
                    case 'services-page': renderServices(); break;
                    case 'send-service-page': renderSendServicePage(); break;
                    case 'courses-page': renderCourses(); break;
                    case 'enrollments-page': renderEnrollments(); break;
                    case 'curriculum-page': renderCurriculum(); break;
                    case 'notices-page': renderNotices(); break;
                    case 'join-class-page': renderJoinClass(); break;
                    case 'withdrawals-page': renderWithdrawals(); break; // NEW
                    case 'settings-page': renderSettings(); break;
                }
            }

            sidebarLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const pageId = link.getAttribute('data-page');
                    navigateTo(pageId);
                });
            });

            // --- Dashboard ---
            async function renderDashboard() {
                try {
                    const servicesSnapshot = await db.collection('services').get();
                    const coursesSnapshot = await db.collection('courses').get();
                    const noticesSnapshot = await db.collection('notices').get();
                    const usersSnapshot = await db.collection('users').get();
                    
                    const paymentsSnapshot = await db.collection('payments').get();
                    
                    let totalSales = 0;
                    let currentMonthSales = 0;
                    let totalProfit = 0;
                    let currentMonthProfit = 0;
                    let pendingPaymentsCount = 0;

                    const now = new Date();
                    const currentMonth = now.getMonth();
                    const currentYear = now.getFullYear();

                    paymentsSnapshot.forEach(doc => {
                        const payment = doc.data();
                        if (payment.status === 'approved') {
                            totalSales += payment.amount || 0;
                            totalProfit += payment.profit || 0;
                            
                            if (payment.timestamp) {
                                const paymentDate = new Date(payment.timestamp.seconds * 1000);
                                if (paymentDate.getMonth() === currentMonth && paymentDate.getFullYear() === currentYear) {
                                    currentMonthSales += payment.amount || 0;
                                    currentMonthProfit += payment.profit || 0;
                                }
                            }
                        } else if (payment.status === 'pending') {
                            pendingPaymentsCount++;
                        }
                    });

                    document.getElementById('total-sales').textContent = `৳${totalSales.toLocaleString('bn-BD')}`;
                    document.getElementById('current-month-sales').textContent = `৳${currentMonthSales.toLocaleString('bn-BD')}`;
                    document.getElementById('total-profit').textContent = `৳${totalProfit.toLocaleString('bn-BD')}`;
                    document.getElementById('current-month-profit').textContent = `৳${currentMonthProfit.toLocaleString('bn-BD')}`;
                    document.getElementById('pending-payments').textContent = pendingPaymentsCount;
                    document.getElementById('total-students').textContent = usersSnapshot.size;
                    document.getElementById('total-services').textContent = servicesSnapshot.size;
                    document.getElementById('total-courses').textContent = coursesSnapshot.size;
                    document.getElementById('total-notices').textContent = noticesSnapshot.size;
                } catch (error) {
                    console.error("Error loading dashboard data:", error);
                }
            }

            // --- START: MODIFIED Send Service Page Functions ---
            async function renderSendServicePage() {
                serviceSelection.innerHTML = '<option value="">তালিকা লোড হচ্ছে...</option>';
                try {
                    const servicesSnapshot = await db.collection('services').get();
                    const coursesSnapshot = await db.collection('courses').get();

                    if (servicesSnapshot.empty && coursesSnapshot.empty) {
                        serviceSelection.innerHTML = '<option value="">কোনো সার্ভিস বা কোর্স পাওয়া যায়নি</option>';
                        return;
                    }

                    let optionsHTML = '<option value="" disabled selected>একটি সার্ভিস বা কোর্স নির্বাচন করুন</option>';
                    
                    optionsHTML += '<optgroup label="সার্ভিস সমূহ">';
                    servicesSnapshot.forEach(doc => {
                        const service = doc.data();
                        optionsHTML += `<option value="${service.name}" data-type="service">${service.name}</option>`;
                    });
                    optionsHTML += '</optgroup>';

                    optionsHTML += '<optgroup label="কোর্স সমূহ">';
                    coursesSnapshot.forEach(doc => {
                        const course = doc.data();
                        optionsHTML += `<option value="${course.name}" data-type="course" data-price="${course.price}" data-duration="${course.duration}">${course.name}</option>`;
                    });
                    optionsHTML += '</optgroup>';
                    
                    serviceSelection.innerHTML = optionsHTML;
                } catch (error) {
                    console.error("Error fetching services/courses for dropdown:", error);
                    serviceSelection.innerHTML = '<option value="">লোড করতে সমস্যা হয়েছে</option>';
                }
            }
            
            function updateServiceInfoTemplate() {
                const selectedOption = serviceSelection.options[serviceSelection.selectedIndex];
                const selectedValue = selectedOption.value;
                const type = selectedOption.dataset.type;
                const today = new Date().toLocaleDateString('en-GB'); // Format: DD/MM/YYYY

                let template = '';

                if (type === 'service') {
                    // --- START: MODIFIED CODE ---
                    const lowerCaseValue = selectedValue.toLowerCase();
                    if (lowerCaseValue.includes('ip service')) {
                        let ipAmount = '';
                        if (lowerCaseValue.includes('premium')) {
                            ipAmount = '200 Pis';
                        } else if (lowerCaseValue.includes('standard')) {
                            ipAmount = '100 Pis';
                        } else if (lowerCaseValue.includes('basic')) {
                            ipAmount = '50 Pis';
                        }
                        template = `Date: ${today}\nService Name: ${selectedValue}\nTop up ID: \nIP Amount: ${ipAmount}\nStatus: Order Complete`;
                    } else if (lowerCaseValue.includes('vps')) {
                         // --- END: MODIFIED CODE ---
                        template = `Date: ${today}\nService Name: ${selectedValue}\nAddress: \nUser ID: \nPassword: \nStatus: Order Complete`;
                    } else {
                        // Generic service template
                         template = `Date: ${today}\nService Name: ${selectedValue}\n\nDetails:\n\nStatus: Order Complete`;
                    }
                } else if (type === 'course') {
                    const price = selectedOption.dataset.price || 'N/A';
                    const duration = selectedOption.dataset.duration || 'N/A';
                    template = `Date: ${today}\nCourse Name: ${selectedValue}\nCourse Price: ${price} BDT\nDuration: ${duration}\nStatus: Enrollment Complete`;
                }
                
                serviceInfoTextarea.value = template;
            }

            if(serviceSelection) {
                serviceSelection.addEventListener('change', updateServiceInfoTemplate);
            }

            if (sendServiceForm) {
                sendServiceForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    let recipientNumber = document.getElementById('whatsapp-number').value.trim();
                    const serviceInfo = serviceInfoTextarea.value.trim();
                    
                    if (!recipientNumber || !serviceInfo) {
                        alert("অনুগ্রহ করে সকল তথ্য পূরণ করুন।");
                        return;
                    }

                    // --- START: MODIFIED CODE ---
                    // Automatically format the phone number
                    recipientNumber = recipientNumber.replace(/[^0-9]/g, ''); // Remove all non-numeric characters
                    if (recipientNumber.startsWith('01') && recipientNumber.length === 11) {
                        // If it's a local number like 017..., convert to 88017...
                        recipientNumber = '880' + recipientNumber.substring(1);
                    }
                    // No 'else' needed; if it's already 880..., it will be used as is.
                    // --- END: MODIFIED CODE ---
                    
                    const encodedMessage = encodeURIComponent(serviceInfo);
                    const whatsappUrl = `https://api.whatsapp.com/send?phone=${recipientNumber}&text=${encodedMessage}`;
                    
                    window.open(whatsappUrl, '_blank');
                });
            }
            // --- END: MODIFIED Send Service Page Functions ---
            
            // --- Settings ---
            async function renderSettings() {
                const heroImageUrlInput = document.getElementById('hero-image-url');
                const heroImagePreview = document.getElementById('hero-image-preview');
                const logoImageUrlInput = document.getElementById('logo-image-url');
                const logoImagePreview = document.getElementById('logo-image-preview');
                const aboutUsImageUrlInput = document.getElementById('about-us-image-url');
                const aboutUsImagePreview = document.getElementById('about-us-image-preview');

                try {
                    const heroDoc = await db.collection('site_settings').doc('hero_section').get();
                    if (heroDoc.exists && heroDoc.data().imageUrl) {
                        const imageUrl = heroDoc.data().imageUrl;
                        heroImageUrlInput.value = imageUrl;
                        heroImagePreview.src = imageUrl;
                    } else {
                         heroImageUrlInput.value = '';
                         heroImagePreview.src = 'https://i.ibb.co/JqgWkCg/placeholder.png';
                    }

                    const logoDoc = await db.collection('site_settings').doc('header_settings').get();
                    if (logoDoc.exists && logoDoc.data().logoImageUrl) {
                        const logoUrl = logoDoc.data().logoImageUrl;
                        logoImageUrlInput.value = logoUrl;
                        logoImagePreview.src = logoUrl;
                    } else {
                        logoImageUrlInput.value = '';
                        logoImagePreview.src = 'https://i.ibb.co/JqgWkCg/placeholder.png';
                    }
                    
                    const aboutUsDoc = await db.collection('site_settings').doc('about_us_section').get();
                    if (aboutUsDoc.exists && aboutUsDoc.data().imageUrl) {
                        const imageUrl = aboutUsDoc.data().imageUrl;
                        aboutUsImageUrlInput.value = imageUrl;
                        aboutUsImagePreview.src = imageUrl;
                    } else {
                        aboutUsImageUrlInput.value = '';
                        aboutUsImagePreview.src = 'https://i.ibb.co/JqgWkCg/placeholder.png';
                    }
                } catch (error) {
                    console.error("Error fetching settings:", error);
                    alert("সেটিংস লোড করতে সমস্যা হয়েছে।");
                }
            }

            heroSettingsForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const newUrl = document.getElementById('hero-image-url').value;
                if (!newUrl) {
                    alert("অনুগ্রহ করে একটি ইমেজ URL দিন।");
                    return;
                }
                try {
                    await db.collection('site_settings').doc('hero_section').set({ imageUrl: newUrl }, { merge: true });
                    alert("হিরো ইমেজ সফলভাবে আপডেট করা হয়েছে!");
                    renderSettings();
                } catch (error) {
                    console.error("Error saving settings:", error);
                    alert("সেটিংস সেভ করতে সমস্যা হয়েছে। \nত্রুটি: " + error.message);
                }
            });
            
            logoSettingsForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const newLogoUrl = document.getElementById('logo-image-url').value;
                if (!newLogoUrl.trim()) {
                    alert("অনুগ্রহ করে লোগোর জন্য একটি ইমেজ URL দিন।");
                    return;
                }
                try {
                    await db.collection('site_settings').doc('header_settings').set({ logoImageUrl: newLogoUrl }, { merge: true });
                    alert("লোগো ইমেজ সফলভাবে সেভ করা হয়েছে!");
                    renderSettings();
                } catch (error) {
                    console.error("Error saving logo image:", error);
                    alert("লোগো ইমেজ সেভ করতে সমস্যা হয়েছে। \nত্রুটি: " + error.message);
                }
            });
            
            aboutUsSettingsForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const newUrl = document.getElementById('about-us-image-url').value;
                if (!newUrl) {
                    alert("অনুগ্রহ করে একটি ইমেজ URL দিন।");
                    return;
                }
                try {
                    await db.collection('site_settings').doc('about_us_section').set({ imageUrl: newUrl }, { merge: true });
                    alert("'আমাদের সম্পর্কে' পাতার ইমেজ সফলভাবে আপডেট করা হয়েছে!");
                    renderSettings();
                } catch (error) {
                    console.error("Error saving 'About Us' image settings:", error);
                    alert("সেটিংস সেভ করতে সমস্যা হয়েছে। \nত্রুটি: " + error.message);
                }
            });

            // --- CRUD Operations ---
            // ================== START: MAJOR UPDATE - AFFILIATE FUNCTIONALITY ==================
            window.updatePaymentStatus = async (docId) => {
                const selectElement = document.getElementById(`status-select-${docId}`);
                const referrerCodeInput = document.getElementById(`referrer-code-${docId}`);
                const saveButton = selectElement.nextElementSibling;

                const newStatus = selectElement.value;
                const referrerCode = referrerCodeInput.value.trim();

                if(saveButton) {
                    saveButton.textContent = 'Saving...';
                    saveButton.disabled = true;
                }

                try {
                    const paymentDocRef = db.collection('payments').doc(docId);
                    const paymentDoc = await paymentDocRef.get();
                    if (!paymentDoc.exists) throw new Error("Payment document not found.");

                    const paymentData = paymentDoc.data();
                    let updateData = { status: newStatus };
                    
                    // --- Commission Logic ---
                    if (newStatus === 'approved' && paymentData.status !== 'approved' && referrerCode) {
                        // Find the referrer
                        const userQuery = await db.collection('users').where('referralCode', '==', referrerCode).limit(1).get();
                        if (userQuery.empty) {
                            alert(`রেফারেল কোড "${referrerCode}" দিয়ে কোনো ব্যবহারকারীকে পাওয়া যায়নি।`);
                        } else {
                            const referrerUser = userQuery.docs[0];
                            
                            // Find the item (course/service) to get commission
                            let commission = 0;
                            const courseQuery = await db.collection('courses').where('name', '==', paymentData.itemName).limit(1).get();
                            const serviceQuery = await db.collection('services').where('name', '==', paymentData.itemName).limit(1).get();
                            
                            if (!courseQuery.empty) {
                                commission = courseQuery.docs[0].data().commission || 0;
                            } else if (!serviceQuery.empty) {
                                commission = serviceQuery.docs[0].data().commission || 0;
                            }

                            if (commission > 0) {
                                // Award commission
                                await referrerUser.ref.update({
                                    affiliateBalance: firebase.firestore.FieldValue.increment(commission)
                                });
                                // Mark payment with referrer info
                                updateData.referrerId = referrerUser.id;
                                updateData.commissionAwarded = commission;
                                alert(`কমিশন ৳${commission} সফলভাবে ${referrerUser.data().name}-কে দেওয়া হয়েছে।`);
                            } else {
                                alert(`এই সার্ভিস/কোর্সের জন্য কোনো কমিশন সেট করা নেই।`);
                            }
                        }
                    }

                    // --- Profit Logic (as before) ---
                    if (newStatus === 'approved') {
                        const serviceQuery = await db.collection('services').where('name', '==', paymentData.itemName).limit(1).get();
                        if (!serviceQuery.empty) {
                            const serviceData = serviceQuery.docs[0].data();
                            updateData.profit = (Number(paymentData.amount) || 0) - (Number(serviceData.purchasePrice) || 0);
                        } else {
                            updateData.profit = Number(paymentData.amount) || 0;
                        }
                    } else {
                        updateData.profit = firebase.firestore.FieldValue.delete();
                    }

                    await paymentDocRef.update(updateData);
                    alert('স্ট্যাটাস সফলভাবে আপডেট করা হয়েছে!');
                    
                    renderPayments();
                    renderDashboard();

                } catch (error) {
                    console.error("--- FIRESTORE UPDATE FAILED ---", error);
                    alert(`স্ট্যাটাস আপডেট করার সময় একটি সমস্যা হয়েছে: ${error.message}`);
                } finally {
                     if(saveButton) {
                        saveButton.textContent = 'Save';
                        saveButton.disabled = false;
                    }
                }
            };
            // ================== END: MAJOR UPDATE - AFFILIATE FUNCTIONALITY ==================
            
            // START: ================== MODIFIED FUNCTION TO SEND WHATSAPP RECEIPT ==================
            window.sendWhatsAppReceipt = async (paymentId) => {
                try {
                    const paymentDoc = await db.collection('payments').doc(paymentId).get();
                    if (!paymentDoc.exists) {
                        alert('পেমেন্টটি খুঁজে পাওয়া যায়নি!');
                        return;
                    }
                    const paymentData = paymentDoc.data();

                    const userQuery = await db.collection('users').where('email', '==', paymentData.userEmail).limit(1).get();
                    if (userQuery.empty) {
                        alert(`শিক্ষার্থীকে খুঁজে পাওয়া যায়নি। অনুগ্রহ করে নিশ্চিত করুন '${paymentData.userEmail}' ইমেইলের শিক্ষার্থীর প্রোফাইল তৈরি করা আছে।`);
                        return;
                    }
                    
                    const userData = userQuery.docs[0].data();
                    const studentMobile = userData.mobile;

                    if (!studentMobile || studentMobile.trim() === '') {
                        alert(`'${userData.name || userData.email}' এর প্রোফাইলের কোনো মোবাইল নম্বর পাওয়া যায়নি। অনুগ্রহ করে শিক্ষার্থীর প্রোফাইলে হোয়াটসঅ্যাপ নম্বর যোগ করুন।`);
                        return;
                    }

                    // --- New Logic to Format Phone Number ---
                    let formattedMobile = studentMobile.replace(/[^0-9]/g, ''); // Remove non-numeric characters
                    
                    if (formattedMobile.startsWith('01') && formattedMobile.length === 11) {
                        // It's a local BD number, so format it with country code
                        formattedMobile = '880' + formattedMobile.substring(1);
                    } else if (formattedMobile.startsWith('8801') && formattedMobile.length === 13) {
                        // It already has the correct country code, do nothing
                    }
                    // --- End of New Logic ---

                    // Data for the template
                    const date = new Date().toLocaleDateString('en-GB'); // Format: DD/MM/YYYY
                    const studentName = userData.name || 'N/A';
                    const itemName = paymentData.itemName;
                    const amount = paymentData.amount;
                    const trxID = paymentData.transactionId || 'N/A';
                    const paymentStatus = 'Payment Successfull';
                    
                    const message = 
`Date                   : ${date}
Student Name   : ${studentName}
Service/Course : ${itemName}
Amount              : ${amount} BDT
TrxID                  : ${trxID}
Payment Status : ${paymentStatus}`;
                    
                    const encodedMessage = encodeURIComponent(message);
                    // Use the newly formatted mobile number
                    const whatsappUrl = `https://api.whatsapp.com/send?phone=${formattedMobile}&text=${encodedMessage}`;
                    
                    window.open(whatsappUrl, '_blank');

                } catch (error) {
                    console.error("Error preparing WhatsApp receipt:", error);
                    alert("হোয়াটসঅ্যাপ মেসেজ প্রস্তুত করার সময় একটি সমস্যা হয়েছে।");
                }
            };
            // END: ================== MODIFIED FUNCTION TO SEND WHATSAPP RECEIPT ==================

            async function renderPayments() {
                const tableBody = document.getElementById('payments-table-body');
                tableBody.innerHTML = `<tr><td colspan="8" style="text-align: center;">পেমেন্টের তথ্য লোড হচ্ছে...</td></tr>`;
                try {
                    const snapshot = await db.collection('payments').orderBy('timestamp', 'desc').get();
                    if (snapshot.empty) {
                        tableBody.innerHTML = `<tr><td colspan="8" style="text-align: center;">এখনও কোনো পেমেন্টের তথ্য জমা পড়েনি।</td></tr>`;
                        return;
                    }
                    let tableHTML = '';
                    snapshot.forEach(doc => {
                        const payment = { id: doc.id, ...doc.data() };
                        const timestamp = payment.timestamp ? new Date(payment.timestamp.seconds * 1000).toLocaleString('bn-BD') : 'N/A';
                        const statusClass = (payment.status || 'pending').toLowerCase();
                        const profit = (payment.status === 'approved' && payment.profit != null) ? `৳ ${payment.profit}` : 'N/A';
                        const referrerInfo = payment.referrerId ? `<br><small style="color:green;">Ref: ${payment.referrerId.substring(0,6)}... (${payment.commissionAwarded}tk)</small>` : '';

                        let whatsappButtonHTML = '';
                        if (payment.status === 'approved') {
                            whatsappButtonHTML = `<button class="btn-whatsapp" onclick="sendWhatsAppReceipt('${payment.id}')" title="Send WhatsApp Receipt"><span class="material-symbols-outlined">send</span></button>`;
                        }

                        // Added data-label attributes for mobile view
                        const row = `
                            <tr>
                                <td data-label="ইমেইল">${payment.userEmail}</td>
                                <td data-label="কোর্স/সার্ভিস">${payment.itemName} ${referrerInfo}</td>
                                <td data-label="পরিমাণ">৳ ${payment.amount}</td>
                                <td data-label="লাভ">${profit}</td>
                                <td data-label="TrxID">${payment.transactionId}</td>
                                <td data-label="সময়">${timestamp}</td>
                                <td data-label="স্ট্যাটাস">
                                    <span class="status-badge ${statusClass}">${payment.status}</span>
                                </td>
                                <td class="actions-cell">
                                    <input type="text" id="referrer-code-${payment.id}" class="referrer-input" placeholder="রেফার কোড" ${payment.status !== 'pending' ? 'disabled' : ''}>
                                    <select class="status-select" id="status-select-${payment.id}">
                                        <option value="pending" ${payment.status === 'pending' ? 'selected' : ''}>Pending</option>
                                        <option value="approved" ${payment.status === 'approved' ? 'selected' : ''}>Approved</option>
                                        <option value="rejected" ${payment.status === 'rejected' ? 'selected' : ''}>Rejected</option>
                                    </select>
                                    <button class="btn btn-save-status" onclick="updatePaymentStatus('${payment.id}')">Save</button>
                                    ${whatsappButtonHTML}
                                    <button class="btn-delete" onclick="deleteItem('payments', '${payment.id}')"><span class="material-symbols-outlined">delete</span></button>
                                </td>
                            </tr>
                        `;
                        tableHTML += row;
                    });
                    tableBody.innerHTML = tableHTML;
                } catch(error) {
                    console.error("--- Payment Rendering Error ---", error);
                    tableBody.innerHTML = `<tr><td colspan="8" style="color: red; text-align: center;">An error occurred: ${error.message}</td></tr>`;
                }
            }
            
            async function renderUsers() {
                const tableBody = document.getElementById('users-table-body');
                tableBody.innerHTML = `<tr><td colspan="6" style="text-align: center;">শিক্ষার্থীদের তথ্য লোড হচ্ছে...</td></tr>`;
                try {
                    const snapshot = await db.collection('users').get();
                    if (snapshot.empty) {
                        tableBody.innerHTML = `<tr><td colspan="6" style="text-align: center;">কোনো নিবন্ধিত শিক্ষার্থী পাওয়া যায়নি।</td></tr>`;
                        return;
                    }
                    let tableHTML = '';
                    snapshot.forEach(doc => {
                        const user = { id: doc.id, ...doc.data() };
                        // Added data-label attributes and click-to-copy functionality for mobile
                        const userMobile = user.mobile || 'N/A';
                        const row = `
                            <tr>
                                <td data-label="নাম">${user.name || 'N/A'}</td>
                                <td data-label="ইমেইল">${user.email}</td>
                                <td data-label="মোবাইল">
                                    <span class="copyable-mobile" onclick="copyToClipboard('${userMobile}')" title="কপি করতে ক্লিক করুন">${userMobile}</span>
                                </td>
                                <td data-label="রেফারেল কোড">${user.referralCode || 'N/A'}</td>
                                <td data-label="ব্যালেন্স">৳ ${user.affiliateBalance || 0}</td>
                                <td class="actions-cell">
                                    <button class="btn-edit" onclick="openModalForEdit('users', '${user.id}')"><span class="material-symbols-outlined">edit</span></button>
                                    <button class="btn-delete" onclick="deleteItem('users', '${user.id}')"><span class="material-symbols-outlined">delete</span></button>
                                </td>
                            </tr>
                        `;
                        tableHTML += row;
                    });
                    tableBody.innerHTML = tableHTML;
                } catch(error) {
                    console.error("--- User Rendering Error ---", error);
                    tableBody.innerHTML = `<tr><td colspan="6" style="color: red; text-align: center;">An error occurred: ${error.message}</td></tr>`;
                }
            }
            
            // --- NEW WITHDRAWAL FUNCTIONS ---
            async function renderWithdrawals() {
                const tableBody = document.getElementById('withdrawals-table-body');
                tableBody.innerHTML = `<tr><td colspan="7" style="text-align: center;">অনুরোধগুলো লোড হচ্ছে...</td></tr>`;
                try {
                    const snapshot = await db.collection('withdrawals').orderBy('requestDate', 'desc').get();
                    if (snapshot.empty) {
                        tableBody.innerHTML = `<tr><td colspan="7" style="text-align: center;">কোনো উত্তোলনের অনুরোধ পাওয়া যায়নি।</td></tr>`;
                        return;
                    }
                    let tableHTML = '';
                    snapshot.forEach(doc => {
                        const req = { id: doc.id, ...doc.data() };
                        const date = req.requestDate ? new Date(req.requestDate.seconds * 1000).toLocaleString('bn-BD') : 'N/A';
                        const statusClass = (req.status || 'pending').toLowerCase();
                        const row = `
                            <tr>
                                <td>${req.userEmail}</td>
                                <td>৳ ${req.amount.toLocaleString('bn-BD')}</td>
                                <td>${req.method}</td>
                                <td>${req.accountNumber}</td>
                                <td>${date}</td>
                                <td><span class="status-badge ${statusClass}">${req.status}</span></td>
                                <td class="actions-cell">
                                    <select class="status-select" id="withdraw-status-${req.id}">
                                        <option value="pending" ${req.status === 'pending' ? 'selected' : ''}>Pending</option>
                                        <option value="paid" ${req.status === 'paid' ? 'selected' : ''}>Paid</option>
                                    </select>
                                    <button class="btn btn-save-status" onclick="updateWithdrawalStatus('${req.id}', '${req.userId}', ${req.amount})">Save</button>
                                    <button class="btn-edit" onclick="openModalForEdit('withdrawals', '${req.id}')"><span class="material-symbols-outlined">edit</span></button>
                                    <button class="btn-delete" onclick="deleteItem('withdrawals', '${req.id}')"><span class="material-symbols-outlined">delete</span></button>
                                </td>
                            </tr>
                        `;
                        tableHTML += row;
                    });
                    tableBody.innerHTML = tableHTML;
                } catch (error) {
                    console.error("Error rendering withdrawals:", error);
                    tableBody.innerHTML = `<tr><td colspan="7" style="color: red; text-align: center;">একটি সমস্যা হয়েছে: ${error.message}</td></tr>`;
                }
            }

            // ================== START: MODIFIED/FIXED CODE ==================
            window.updateWithdrawalStatus = async (docId, userId, amount) => {
                const selectElement = document.getElementById(`withdraw-status-${docId}`);
                const newStatus = selectElement.value;

                try {
                    const withdrawDocRef = db.collection('withdrawals').doc(docId);
                    const userDocRef = db.collection('users').doc(userId);
                    
                    const withdrawDoc = await withdrawDocRef.get();
                    if (!withdrawDoc.exists) {
                        throw new Error("উত্তোলনের অনুরোধটি পাওয়া যায়নি।");
                    }
                    const oldStatus = withdrawDoc.data().status;

                    // যদি স্ট্যাটাস পরিবর্তন না হয়, তাহলে কিছুই করার দরকার নেই
                    if (oldStatus === newStatus) {
                        alert('স্ট্যাটাস পরিবর্তন হয়নি।');
                        return;
                    }

                    // কেস ১: Pending থেকে Paid করা হচ্ছে (ব্যালেন্স কেটে নেওয়া হবে)
                    if (oldStatus === 'pending' && newStatus === 'paid') {
                        await db.runTransaction(async (transaction) => {
                            const userDoc = await transaction.get(userDocRef);
                            if (!userDoc.exists) {
                                throw new Error("ব্যবহারকারীকে খুঁজে পাওয়া যায়নি!");
                            }
                            // ব্যবহারকারীর ব্যালেন্স কমানো হচ্ছে
                            transaction.update(userDocRef, { 
                                affiliateBalance: firebase.firestore.FieldValue.increment(-amount) 
                            });
                            // উত্তোলনের স্ট্যাটাস আপডেট করা হচ্ছে
                            transaction.update(withdrawDocRef, { status: newStatus });
                        });
                        alert('স্ট্যাটাস "Paid" করা হয়েছে এবং ব্যবহারকারীর ব্যালেন্স থেকে টাকা কেটে নেওয়া হয়েছে।');
                    
                    // কেস ২: Paid থেকে Pending করা হচ্ছে (ব্যালেন্স ফেরত দেওয়া হবে)
                    } else if (oldStatus === 'paid' && newStatus === 'pending') {
                         await db.runTransaction(async (transaction) => {
                            const userDoc = await transaction.get(userDocRef);
                            if (!userDoc.exists) {
                                throw new Error("ব্যবহারকারীকে খুঁজে পাওয়া যায়নি!");
                            }
                            // ব্যবহারকারীর ব্যালেন্স বাড়ানো হচ্ছে (ফেরত)
                            transaction.update(userDocRef, { 
                                affiliateBalance: firebase.firestore.FieldValue.increment(amount) 
                            });
                            // উত্তোলনের স্ট্যাটাস আপডেট করা হচ্ছে
                            transaction.update(withdrawDocRef, { status: newStatus });
                        });
                        alert('স্ট্যাটাস "Pending" করা হয়েছে এবং ব্যবহারকারীর ব্যালেন্সে টাকা ফেরত দেওয়া হয়েছে।');

                    // কেস ৩: অন্য কোনো স্ট্যাটাস পরিবর্তন হলে শুধু স্ট্যাটাস আপডেট হবে
                    } else {
                        await withdrawDocRef.update({ status: newStatus });
                        alert('স্ট্যাটাস সফলভাবে আপডেট করা হয়েছে।');
                    }

                    renderWithdrawals(); // তালিকা রিফ্রেশ করা হচ্ছে
                } catch (error) {
                    console.error("Error updating withdrawal status:", error);
                    alert(`স্ট্যাটাস আপডেট করতে সমস্যা হয়েছে: ${error.message}`);
                }
            };
            // ================== END: MODIFIED/FIXED CODE ==================


            async function renderServices() {
                try {
                    const snapshot = await db.collection('services').get();
                    const tableBody = document.getElementById('services-table-body');
                    tableBody.innerHTML = '';
                    if (snapshot.empty) {
                        tableBody.innerHTML = `<tr><td colspan="5" style="text-align: center;">কোনো সার্ভিস যোগ করা হয়নি।</td></tr>`;
                        return;
                    }
                    snapshot.forEach(doc => {
                        const service = { id: doc.id, ...doc.data() };
                        const row = `
                            <tr>
                                <td>${service.name}</td>
                                <td>৳ ${service.purchasePrice || 0}</td>
                                <td>৳ ${service.currentPrice}</td>
                                <td>৳ ${service.commission || 0}</td>
                                <td class="actions-cell">
                                    <button class="btn-edit" onclick="openModalForEdit('services', '${service.id}')"><span class="material-symbols-outlined">edit</span></button>
                                    <button class="btn-delete" onclick="deleteItem('services', '${service.id}')"><span class="material-symbols-outlined">delete</span></button>
                                </td>
                            </tr>
                        `;
                        tableBody.innerHTML += row;
                    });
                } catch(error) {
                    console.error("Error rendering services:", error);
                }
            }

            async function renderCourses() {
                try {
                    const snapshot = await db.collection('courses').get();
                    const tableBody = document.getElementById('courses-table-body');
                    tableBody.innerHTML = '';
                     if (snapshot.empty) {
                        tableBody.innerHTML = `<tr><td colspan="5" style="text-align: center;">কোনো কোর্স যোগ করা হয়নি।</td></tr>`;
                        return;
                    }
                    snapshot.forEach(doc => {
                        const course = { id: doc.id, ...doc.data() };
                        const row = `
                            <tr>
                                <td>${course.name}</td>
                                <td>${course.instructor}</td>
                                <td>৳ ${course.price}</td>
                                <td>৳ ${course.commission || 0}</td>
                                <td class="actions-cell">
                                    <button class="btn-edit" onclick="openModalForEdit('courses', '${course.id}')"><span class="material-symbols-outlined">edit</span></button>
                                    <button class="btn-delete" onclick="deleteItem('courses', '${course.id}')"><span class="material-symbols-outlined">delete</span></button>
                                </td>
                            </tr>
                        `;
                        tableBody.innerHTML += row;
                    });
                } catch(error) {
                    console.error("Error rendering courses:", error);
                }
            }

            async function renderEnrollments() {
                const tableBody = document.getElementById('enrollments-table-body');
                try {
                    tableBody.innerHTML = `<tr><td colspan="4" style="text-align: center;">এনরোলমেন্টের তথ্য লোড হচ্ছে...</td></tr>`;
                    const snapshot = await db.collection('enrollments').orderBy('enrollmentDate', 'desc').get();
                    if (snapshot.empty) {
                        tableBody.innerHTML = `<tr><td colspan="4" style="text-align: center;">কোনো এনরোলমেন্ট পাওয়া যায়নি।</td></tr>`;
                        return;
                    }
                    let tableHTML = '';
                    snapshot.forEach(doc => {
                        const enrollment = { id: doc.id, ...doc.data() };
                        const row = `
                            <tr>
                                <td>${enrollment.studentEmail}</td>
                                <td>${enrollment.courseName}</td>
                                <td>${enrollment.batch}</td>
                                <td class="actions-cell">
                                    <button class="btn-delete" onclick="deleteItem('enrollments', '${enrollment.id}')"><span class="material-symbols-outlined">delete</span></button>
                                </td>
                            </tr>
                        `;
                        tableHTML += row;
                    });
                    tableBody.innerHTML = tableHTML;
                } catch(error) {
                    console.error("Error rendering enrollments:", error);
                    tableBody.innerHTML = `<tr><td colspan="4" style="text-align: center; color: red;">তথ্য লোড করতে সমস্যা হয়েছে।</td></tr>`;
                }
            }
            
            async function renderCurriculum() {
                const tableBody = document.getElementById('curriculum-table-body');
                 tableBody.innerHTML = `<tr><td colspan="4" style="text-align: center;">কারিকুলাম তথ্য লোড হচ্ছে...</td></tr>`;
                try {
                    const snapshot = await db.collection('curriculum').get();
                    if (snapshot.empty) {
                        tableBody.innerHTML = `<tr><td colspan="4" style="text-align: center;">কোনো কারিকুলাম পাওয়া যায়নি।</td></tr>`;
                        return;
                    }
                    let tableHTML = '';
                    snapshot.forEach(doc => {
                        const curriculum = { id: doc.id, ...doc.data() };
                        const moduleCount = curriculum.modules ? curriculum.modules.length : 0;
                        const row = `
                            <tr>
                                <td>${curriculum.courseName}</td>
                                <td>${curriculum.batch}</td>
                                <td>${moduleCount}</td>
                                <td class="actions-cell">
                                     <button class="btn-edit" onclick="openModalForEdit('curriculum', '${curriculum.id}')"><span class="material-symbols-outlined">edit</span></button>
                                    <button class="btn-delete" onclick="deleteItem('curriculum', '${curriculum.id}')"><span class="material-symbols-outlined">delete</span></button>
                                </td>
                            </tr>
                        `;
                        tableHTML += row;
                    });
                    tableBody.innerHTML = tableHTML;
                } catch (error) {
                    console.error("Error rendering curriculum:", error);
                    tableBody.innerHTML = `<tr><td colspan="4" style="text-align: center; color: red;">তথ্য লোড করতে সমস্যা হয়েছে।</td></tr>`;
                }
            }

            async function renderNotices() {
                try {
                    const snapshot = await db.collection('notices').orderBy('timestamp', 'desc').get();
                    const tableBody = document.getElementById('notices-table-body');
                    tableBody.innerHTML = '';
                     if (snapshot.empty) {
                        tableBody.innerHTML = `<tr><td colspan="3" style="text-align: center;">কোনো নোটিশ পাওয়া যায়নি।</td></tr>`;
                        return;
                    }
                    snapshot.forEach(doc => {
                        const notice = { id: doc.id, ...doc.data() };
                        const row = `
                            <tr>
                                <td>${notice.title}</td>
                                <td>${(notice.description || '').substring(0, 50)}...</td>
                                <td class="actions-cell">
                                    <button class="btn-edit" onclick="openModalForEdit('notices', '${notice.id}')"><span class="material-symbols-outlined">edit</span></button>
                                    <button class="btn-delete" onclick="deleteItem('notices', '${notice.id}')"><span class="material-symbols-outlined">delete</span></button>
                                </td>
                            </tr>
                        `;
                        tableBody.innerHTML += row;
                    });
                } catch(error) {
                    console.error("Error rendering notices:", error);
                }
            }

            async function renderJoinClass() {
                try {
                    const snapshot = await db.collection('joinClass').orderBy('dateTime', 'desc').get();
                    const tableBody = document.getElementById('join-class-table-body');
                    tableBody.innerHTML = '';
                     if (snapshot.empty) {
                        tableBody.innerHTML = `<tr><td colspan="6" style="text-align: center;">কোনো ক্লাস লিঙ্ক যোগ করা হয়নি।</td></tr>`;
                        return;
                    }
                    snapshot.forEach(doc => {
                        const classInfo = { id: doc.id, ...doc.data() };
                        const classTime = classInfo.dateTime ? new Date(classInfo.dateTime.seconds * 1000).toLocaleString('bn-BD') : 'N/A';
                        const row = `
                            <tr>
                                <td>${classInfo.courseName}</td>
                                <td>${classInfo.batch || 'N/A'}</td>
                                <td>${classInfo.topic || 'N/A'}</td>
                                <td><a href="${classInfo.link}" target="_blank">ক্লাস লিঙ্ক</a></td>
                                <td>${classTime}</td>
                                <td class="actions-cell">
                                    <button class="btn-edit" onclick="openModalForEdit('joinClass', '${classInfo.id}')"><span class="material-symbols-outlined">edit</span></button>
                                    <button class="btn-delete" onclick="deleteItem('joinClass', '${classInfo.id}')"><span class="material-symbols-outlined">delete</span></button>
                                </td>
                            </tr>
                        `;
                        tableBody.innerHTML += row;
                    });
                } catch(error) {
                    console.error("Error rendering join class links:", error);
                }
            }

            window.openModalForAdd = async (collection) => {
                modalForm.reset();
                let formFieldsHTML = '';
                modalTitle.textContent = `নতুন ${getBengaliTypeName(collection)} যোগ করুন`;
                
                if (collection === 'enrollments' || collection === 'joinClass' || collection === 'curriculum') {
                    let loadingMessage = 'কোর্সের তালিকা';
                    if(collection === 'enrollments') loadingMessage = 'শিক্ষার্থী ও কোর্সের তালিকা';
                    
                    modalForm.innerHTML = `<p style="text-align:center;">${loadingMessage} লোড হচ্ছে...</p>`;
                    adminModal.classList.remove('hidden');

                    try {
                        const coursesSnapshot = await db.collection('courses').get();
                        let courseOptions = coursesSnapshot.docs.map(doc => `<option value="${doc.data().name}">${doc.data().name}</option>`).join('');

                        if (collection === 'enrollments') {
                            const usersSnapshot = await db.collection('users').get();
                            let userOptions = usersSnapshot.docs.map(doc => `<option value="${doc.id}|${doc.data().email}">${doc.data().name || 'N/A'} (${doc.data().email})</option>`).join('');
                            formFieldsHTML = getFormFields(collection, {}, { userOptions, courseOptions });
                        } else {
                            formFieldsHTML = getFormFields(collection, {}, { courseOptions });
                        }
                    } catch (error) {
                        console.error("Error fetching data for modal:", error);
                        alert(`${loadingMessage} আনতে সমস্যা হয়েছে।`);
                        formFieldsHTML = `<p style="text-align:center; color: red;">একটি সমস্যা হয়েছে। আবার চেষ্টা করুন।</p>`;
                    }
                } else {
                    formFieldsHTML = getFormFields(collection);
                }

                modalForm.innerHTML = formFieldsHTML + getFormFooter();
                adminModal.classList.remove('hidden');

                modalForm.onsubmit = (e) => {
                    e.preventDefault();
                    saveItem(collection);
                };
            };

            window.openModalForEdit = async (collection, id) => {
                try {
                    const doc = await db.collection(collection).doc(id).get();
                    if (!doc.exists) {
                        console.error("No such document!");
                        return;
                    }
                    const itemData = doc.data();
                    let formFieldsHTML = '';

                    if (collection === 'joinClass' || collection === 'curriculum') {
                        modalForm.innerHTML = `<p style="text-align:center;">কোর্সের তালিকা লোড হচ্ছে...</p>`;
                        adminModal.classList.remove('hidden');
                        const coursesSnapshot = await db.collection('courses').get();
                        let courseOptions = coursesSnapshot.docs.map(courseDoc => {
                            const courseName = courseDoc.data().name;
                            const isSelected = courseName === itemData.courseName ? 'selected' : '';
                            return `<option value="${courseName}" ${isSelected}>${courseName}</option>`;
                        }).join('');
                        formFieldsHTML = getFormFields(collection, itemData, { courseOptions });
                    } else {
                        formFieldsHTML = getFormFields(collection, itemData);
                    }

                    modalForm.innerHTML = formFieldsHTML + getFormFooter();
                    modalTitle.textContent = `${getBengaliTypeName(collection)} এডিট করুন`;
                    adminModal.classList.remove('hidden');

                    modalForm.onsubmit = (e) => {
                        e.preventDefault();
                        saveItem(collection, id);
                    };
                } catch(error) {
                    console.error("Error opening edit modal:", error);
                    alert("এডিট করার জন্য তথ্য লোড করতে সমস্যা হয়েছে।");
                }
            };

            window.deleteItem = async (collection, id) => {
                if(confirm('আপনি কি নিশ্চিতভাবে এটি ডিলিট করতে চান?')) {
                    try {
                        await db.collection(collection).doc(id).delete();
                        alert('সফলভাবে ডিলিট করা হয়েছে।');
                        const currentPageId = document.querySelector('.page.active').id;
                        navigateTo(currentPageId);
                        renderDashboard();
                    } catch(error) {
                        console.error("Error deleting item:", error);
                        alert('ডিলিট করার সময় একটি সমস্যা হয়েছে।');
                    }
                }
            };
            
            async function saveItem(collection, id = null) {
                const formData = new FormData(modalForm);
                let newItem;
                let type = collection;

                if (type === 'services') {
                    newItem = {
                        name: (formData.get('name') || '').trim(),
                        description: (formData.get('description') || '').trim(),
                        purchasePrice: Number(formData.get('purchasePrice')) || 0,
                        oldPrice: Number(formData.get('oldPrice')) || 0,
                        currentPrice: Number(formData.get('currentPrice')) || 0,
                        commission: Number(formData.get('commission')) || 0, // Added commission
                        features: (formData.get('features') || '').split(',').map(f => f.trim())
                    };
                } else if (type === 'courses') {
                     newItem = {
                        name: (formData.get('name') || '').trim(),
                        instructor: (formData.get('instructor') || '').trim(),
                        price: Number(formData.get('price')) || 0,
                        commission: Number(formData.get('commission')) || 0, // Added commission
                        category: (formData.get('category') || '').trim(),
                        duration: (formData.get('duration') || '').trim(),
                        lectures: Number(formData.get('lectures')) || 0,
                        image: (formData.get('image') || '').trim(),
                    };
                } else if (type === 'enrollments') {
                    const studentData = (formData.get('student') || '|').split('|');
                    const courseName = formData.get('courseName');
                    const batch = (formData.get('batch') || '').trim();
                    if (!studentData[0] || !courseName || !batch) {
                        alert("অনুগ্রহ করে সকল তথ্য পূরণ করুন।");
                        return;
                    }
                    const courseQuery = await db.collection('courses').where('name', '==', courseName).limit(1).get();
                     if (courseQuery.empty) {
                        alert("নির্বাচিত কোর্সটি খুঁজে পাওয়া যায়নি।");
                        return;
                    }
                    const courseDetails = courseQuery.docs[0].data();
                    newItem = {
                        studentUid: studentData[0],
                        studentEmail: studentData[1],
                        courseName: courseName,
                        batch: batch,
                        enrollmentDate: new Date(),
                        courseImage: courseDetails.image || 'https://i.ibb.co/JqgWkCg/placeholder.png',
                        courseCategory: courseDetails.category || 'General'
                    };
                } else if (type === 'joinClass') {
                    newItem = {
                        courseName: (formData.get('courseName') || '').trim(),
                        batch: (formData.get('batch') || '').trim(),
                        topic: (formData.get('topic') || '').trim(),
                        classNumber: Number(formData.get('classNumber')) || 0,
                        link: (formData.get('link') || '').trim(),
                        dateTime: new Date(formData.get('dateTime'))
                    };
                } else if (type === 'curriculum') {
                    const modules = [];
                    document.querySelectorAll('.module-container').forEach(moduleEl => {
                        const moduleTitle = moduleEl.querySelector('input[name="moduleTitle"]').value;
                        const videos = [];
                        moduleEl.querySelectorAll('.video-entry').forEach(videoEl => {
                            videos.push({
                                title: videoEl.querySelector('input[name="videoTitle"]').value,
                                youtubeLink: videoEl.querySelector('input[name="videoLink"]').value,
                                duration: videoEl.querySelector('input[name="videoDuration"]').value,
                                classNote: videoEl.querySelector('textarea[name="classNote"]').value // Save class note
                            });
                        });
                        modules.push({ title: moduleTitle, videos: videos });
                    });
                    newItem = {
                        courseName: (formData.get('courseName') || '').trim(),
                        batch: (formData.get('batch') || '').trim(),
                        modules: modules
                    };
                } else if (type === 'withdrawals') { // MODIFIED: Added this block
                    newItem = {
                        amount: Number(formData.get('amount')) || 0,
                        method: (formData.get('method') || '').trim(),
                        accountNumber: (formData.get('accountNumber') || '').trim()
                    };
                } else if (type === 'users') {
                    newItem = {
                        name: (formData.get('name') || '').trim(),
                        mobile: (formData.get('mobile') || '').trim(),
                        title: (formData.get('title') || '').trim(),
                        referralCode: (formData.get('referralCode') || '').trim(), // Added field
                        affiliateBalance: Number(formData.get('affiliateBalance')) || 0 // Added field
                    };
                    const password = (formData.get('password') || '').trim();
                    if (password) {
                        newItem.password = password;
                    }
                } else { // notices
                    newItem = {
                        title: (formData.get('title') || '').trim(),
                        description: (formData.get('description') || '').trim(),
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    };
                }

                try {
                    if (id) {
                        await db.collection(collection).doc(id).set(newItem, { merge: true });
                    } else {
                        await db.collection(collection).add(newItem);
                    }
                    adminModal.classList.add('hidden');
                    const currentPageId = document.querySelector('.page.active').id;
                    navigateTo(currentPageId);
                    renderDashboard();
                } catch(error) {
                    console.error("Error saving item:", error);
                    alert("তথ্য সংরক্ষণ করার সময় একটি সমস্যা হয়েছে।");
                }
            }
            
            modalForm.addEventListener('click', function(e) {
                const addModuleBtn = e.target.closest('#add-module-btn');
                const addVideoBtn = e.target.closest('.btn-add-video');
                const removeBtn = e.target.closest('.btn-remove');

                if (addModuleBtn) {
                    e.preventDefault();
                    const container = document.getElementById('curriculum-modules-container');
                    container.insertAdjacentHTML('beforeend', getModuleHTML());
                }
                if (addVideoBtn) {
                    e.preventDefault();
                    const videosContainer = addVideoBtn.previousElementSibling;
                    if (videosContainer && videosContainer.classList.contains('videos-container')) {
                        videosContainer.insertAdjacentHTML('beforeend', getVideoHTML());
                    }
                }
                if (removeBtn) {
                     e.preventDefault();
                     removeBtn.closest('.module-container, .video-entry').remove();
                }
            });

            // --- Modal and Form Helpers ---
            closeModalBtn.addEventListener('click', () => adminModal.classList.add('hidden'));

            function getBengaliTypeName(collection) {
                if (collection === 'services') return 'সার্ভিস';
                if (collection === 'courses') return 'কোর্স';
                if (collection === 'enrollments') return 'এনরোলমেন্ট';
                if (collection === 'joinClass') return 'ক্লাস লিঙ্ক';
                if (collection === 'curriculum') return 'কারিকুলাম';
                if (collection === 'users') return 'শিক্ষার্থী';
                if (collection === 'withdrawals') return 'উত্তোলনের অনুরোধ'; // MODIFIED: Added this line
                return 'নোটিশ';
            }

            function getModuleHTML(module = { title: '', videos: [] }) {
                 return `
                    <div class="module-container">
                        <div class="module-header-flex">
                            <h4>মডিউল / ক্লাস</h4>
                            <button type="button" class="btn btn-remove">মডিউল মুছুন</button>
                        </div>
                        <div class="form-group">
                            <label>মডিউলের শিরোনাম</label>
                            <input type="text" name="moduleTitle" placeholder="Class 01: Introduction" value="${module.title || ''}" required>
                        </div>
                        <div class="videos-container">
                            ${(module.videos || []).map(getVideoHTML).join('')}
                        </div>
                        <button type="button" class="btn btn-add-small btn-add-video"><span class="material-symbols-outlined">add</span> নতুন ভিডিও যোগ করুন</button>
                    </div>
                 `;
            }
            
            function getVideoHTML(video = { title: '', youtubeLink: '', duration: '', classNote: '' }) {
                return `
                    <div class="video-entry">
                        <div class="video-entry-inputs">
                            <input type="text" name="videoTitle" placeholder="ভিডিওর শিরোনাম" value="${video.title || ''}" required>
                            <input type="text" name="videoLink" placeholder="ইউটিউব লিঙ্ক" value="${video.youtubeLink || ''}" required>
                            <input type="text" name="videoDuration" placeholder="সময়কাল (e.g., 10:45)" value="${video.duration || ''}">
                            <button type="button" class="btn-remove"><span class="material-symbols-outlined">delete</span></button>
                        </div>
                        <textarea name="classNote" placeholder="ক্লাসের নোট এখানে লিখুন... (ঐচ্ছিক)">${video.classNote || ''}</textarea>
                    </div>
                `;
            }

            function getFormFields(type, data = {}, extra = {}) {
                if (type === 'services') {
                    return `
                        <div class="form-group">
                            <label>সার্ভিসের নাম</label>
                            <input type="text" name="name" value="${data.name || ''}" required>
                        </div>
                        <div class="form-group">
                            <label>ছোট বর্ণনা</label>
                            <textarea name="description" rows="3">${data.description || ''}</textarea>
                        </div>
                        <div class="form-group">
                            <label>ক্রয়মূল্য (Purchase Price)</label>
                            <input type="number" name="purchasePrice" value="${data.purchasePrice || 0}" required>
                        </div>
                        <div class="form-group">
                            <label>বর্তমান মূল্য (Selling Price)</label>
                            <input type="number" name="currentPrice" value="${data.currentPrice || 0}" required>
                        </div>
                        <div class="form-group">
                            <label>কমিশন (টাকা)</label>
                            <input type="number" name="commission" value="${data.commission || 0}">
                        </div>
                        <div class="form-group">
                            <label>পূর্বের মূল্য</label>
                            <input type="number" name="oldPrice" value="${data.oldPrice || 0}">
                        </div>
                        <div class="form-group">
                            <label>ফিচার সমূহ (কমা দিয়ে আলাদা করুন)</label>
                            <input type="text" name="features" value="${(data.features || []).join(', ')}">
                        </div>
                    `;
                }
                if (type === 'courses') {
                    return `
                        <div class="form-group">
                            <label>কোর্সের নাম</label>
                            <input type="text" name="name" value="${data.name || ''}" required>
                        </div>
                        <div class="form-group">
                            <label>প্রশিক্ষকের নাম</label>
                            <input type="text" name="instructor" value="${data.instructor || ''}" required>
                        </div>
                        <div class="form-group">
                            <label>মূল্য</label>
                            <input type="number" name="price" value="${data.price || 0}" required>
                        </div>
                        <div class="form-group">
                            <label>কমিশন (টাকা)</label>
                            <input type="number" name="commission" value="${data.commission || 0}">
                        </div>
                        <div class="form-group">
                            <label>ক্যাটাগরি</label>
                            <input type="text" name="category" value="${data.category || ''}" placeholder="e.g., FREELANCING">
                        </div>
                        <div class="form-group">
                            <label>সময়কাল</label>
                            <input type="text" name="duration" value="${data.duration || ''}" placeholder="e.g., 24:00 ঘণ্টা">
                        </div>
                        <div class="form-group">
                            <label>লেকচার সংখ্যা</label>
                            <input type="number" name="lectures" value="${data.lectures || 0}" placeholder="e.g., 40">
                        </div>
                        <div class="form-group">
                            <label>ছবি URL</label>
                            <input type="text" name="image" value="${data.image || ''}" placeholder="https://i.ibb.co/JqgWkCg/placeholder.png">
                        </div>
                    `;
                }
                if (type === 'enrollments') {
                    return `
                        <div class="form-group">
                            <label>শিক্ষার্থী নির্বাচন করুন</label>
                            <select name="student" required>${extra.userOptions || ''}</select>
                        </div>
                        <div class="form-group">
                            <label>কোর্স নির্বাচন করুন</label>
                            <select name="courseName" required>${extra.courseOptions || ''}</select>
                        </div>
                        <div class="form-group">
                            <label>ব্যাচ নং</label>
                            <input type="text" name="batch" value="${data.batch || ''}" placeholder="যেমন: 122" required>
                        </div>
                    `;
                }
                if (type === 'joinClass') {
                    const dateTimeValue = data.dateTime ? new Date(data.dateTime.seconds * 1000).toISOString().slice(0, 16) : '';
                    return `
                        <div class="form-group">
                            <label>কোর্স নির্বাচন করুন</label>
                            <select name="courseName" required>${extra.courseOptions || ''}</select>
                        </div>
                        <div class="form-group">
                            <label>ব্যাচ নং</label>
                            <input type="text" name="batch" value="${data.batch || ''}" placeholder="যেমন: 122" required>
                        </div>
                        <div class="form-group">
                            <label>ক্লাসের টপিক</label>
                            <input type="text" name="topic" value="${data.topic || ''}" placeholder="যেমন: Introduction to Freelancing" required>
                        </div>
                        <div class="form-group">
                            <label>ক্লাস নং</label>
                            <input type="number" name="classNumber" value="${data.classNumber || ''}" placeholder="যেমন: 1" required>
                        </div>
                         <div class="form-group">
                            <label>ক্লাসের লিঙ্ক</label>
                            <input type="text" name="link" value="${data.link || ''}" placeholder="https://meet.google.com/..." required>
                        </div>
                         <div class="form-group">
                            <label>ক্লাসের তারিখ ও সময়</label>
                            <input type="datetime-local" name="dateTime" value="${dateTimeValue}" required>
                        </div>
                    `;
                }
                if (type === 'curriculum') {
                    return `
                        <div class="form-group">
                            <label>কোর্স নির্বাচন করুন</label>
                            <select name="courseName" required>${extra.courseOptions || ''}</select>
                        </div>
                        <div class="form-group">
                            <label>ব্যাচ নং</label>
                            <input type="text" name="batch" value="${data.batch || ''}" placeholder="যেমন: 122" required>
                        </div>
                        <hr style="margin: 20px 0;">
                        <div id="curriculum-modules-container">
                           ${(data.modules && data.modules.length > 0) ? data.modules.map(getModuleHTML).join('') : getModuleHTML()}
                        </div>
                        <button type="button" id="add-module-btn" class="btn btn-add-small"><span class="material-symbols-outlined">add</span> নতুন মডিউল যোগ করুন</button>
                    `;
                }
                if (type === 'withdrawals') { // MODIFIED: Added this block
                    return `
                        <div class="form-group">
                            <label>শিক্ষার্থীর ইমেইল (সম্পাদনাযোগ্য নয়)</label>
                            <input type="email" name="userEmail" value="${data.userEmail || ''}" readonly>
                        </div>
                        <div class="form-group">
                            <label>পরিমাণ</label>
                            <input type="number" name="amount" value="${data.amount || 0}" required>
                        </div>
                        <div class="form-group">
                            <label>মাধ্যম (e.g., Bkash, Nagad)</label>
                            <input type="text" name="method" value="${data.method || ''}" required>
                        </div>
                        <div class="form-group">
                            <label>অ্যাকাউন্ট নম্বর</label>
                            <input type="text" name="accountNumber" value="${data.accountNumber || ''}" required>
                        </div>
                    `;
                }
                if (type === 'notices') {
                    return `
                        <div class="form-group">
                            <label>শিরোনাম</label>
                            <input type="text" name="title" value="${data.title || ''}" required>
                        </div>
                         <div class="form-group">
                            <label>বর্ণনা</label>
                            <textarea name="description" rows="4" required>${data.description || ''}</textarea>
                        </div>
                    `;
                }
                if (type === 'users') {
                    return `
                        <div class="form-group">
                            <label>নাম</label>
                            <input type="text" name="name" value="${data.name || ''}" >
                        </div>
                        <div class="form-group">
                            <label>ইমেইল (সম্পাদনাযোগ্য নয়)</label>
                            <input type="email" name="email" value="${data.email || ''}" readonly>
                        </div>
                        <div class="form-group">
                            <label>মোবাইল</label>
                            <input type="text" name="mobile" value="${data.mobile || ''}" >
                        </div>
                         <div class="form-group">
                            <label>টাইটেল</label>
                            <input type="text" name="title" value="${data.title || ''}" >
                        </div>
                        <div class="form-group">
                            <label>রেফারেল কোড</label>
                            <input type="text" name="referralCode" value="${data.referralCode || ''}" >
                        </div>
                         <div class="form-group">
                            <label>অ্যাফিলিয়েট ব্যালেন্স</label>
                            <input type="number" name="affiliateBalance" value="${data.affiliateBalance || 0}" >
                        </div>
                        <div class="form-group">
                            <label>নতুন পাসওয়ার্ড</label>
                            <input type="text" name="password" placeholder="খালি রাখলে পাসওয়ার্ড পরিবর্তন হবে না">
                        </div>
                    `;
                }
                return '';
            }

            function getFormFooter() {
                return `
                    <div class="modal-footer">
                        <button type="button" class="btn btn-cancel" onclick="document.getElementById('admin-modal').classList.add('hidden')"> বাতিল করুন</button>
                        <button type="submit" class="btn btn-primary">সংরক্ষণ করুন</button>
                    </div>
                `;
            }

        });
    </script>
</body>
</html>
